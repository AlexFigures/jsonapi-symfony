# JSON:API 1.1 Conformance Coverage Matrix

| Normative area | Spec reference | Tests exercising behaviour | Status | Notes |
| --- | --- | --- | --- | --- |
| Media type negotiation (Accept/Content-Type, 406/415, `Vary`) | JSON:API §1.1, §1.2 | `tests/Functional/ContentNegotiationTest.php` lines 28-64; `tests/Functional/Errors/NegotiationErrorsTest.php` lines 17-58 | ✅ OK | Strict JSON:API media type enforced; Vary: Accept header asserted. No coverage for charset handling or multiple media ranges. |
| Media type negotiation with `ext="https://jsonapi.org/ext/atomic"` | JSON:API Atomic Operations §1.1 | `tests/Functional/Atomic/AtomicOperationsTest.php` lines 34-90 | ✅ OK | Atomic operations require ext parameter and reject missing ext. |
| Profile negotiation (RFC 6906, Link header) | JSON:API Profiles §1.0 | `tests/Functional/Profile/ProfileNegotiationSubscriberTest.php` lines 23-74 | ⚠️ Partially covered | Subscriber decorates responses; no functional tests on Accept `profile` negotiation, conflict handling, or interaction with controllers. |
| Document top-level members (`jsonapi`, `links`, `meta`, `data`, `included`) | JSON:API §1.4 | `tests/Functional/CollectionGetTest.php` lines 12-27; `tests/Functional/ResourceGetTest.php` lines 12-51 | ✅ OK | Documents include jsonapi version, pagination links, resource data. Meta pagination covered; general meta semantics untested. |
| Resource object structure (type/id, attributes, relationships, links) | JSON:API §1.4 | `tests/Functional/ResourceGetTest.php` lines 33-50; `tests/Functional/Relationships/RelationshipGetTest.php` lines 13-38 | ✅ OK | Resource and relationship linkage validated. Gaps for relationship meta/links overrides. |
| Collection pagination & sorting (page[number|size], sort) | JSON:API §1.5 | `tests/Functional/SortAndPageTest.php` lines 12-34 | ✅ OK | Basic page & sort interactions verified; cursor pagination and page-based error paths missing. |
| Sparse fieldsets | JSON:API §1.5 | `tests/Functional/FieldsTest.php` lines 12-23 | ✅ OK | Single-type sparse fieldset supported; no tests for multi-type or relationship fields. |
| Inclusion of related resources (`include`) | JSON:API §1.5 | `tests/Functional/IncludeTest.php` lines 12-28; `tests/Functional/ResourceGetTest.php` lines 53-64 | ✅ OK | Include populates `included` collection and relationship linkage; nesting depth & cycles untested. |
| Error objects (code/status/title/detail/source) | JSON:API §1.6 | `tests/Functional/Errors/ValidationErrorsTest.php` lines 21-79; `tests/Functional/Errors/NegotiationErrorsTest.php` lines 17-58; `tests/Functional/ResourceWriteTest.php` lines 104-225 | ⚠️ Partially covered | Validation, negotiation, and conflict errors mapped; gaps for top-level `meta`, `links`, multiple sources, bulk error formatting. |
| Relationship endpoints (`relationships` vs `related`) | JSON:API §1.7 | `tests/Functional/Relationships/RelationshipGetTest.php` lines 13-38; `tests/Functional/Relationships/RelatedGetTest.php` lines 14-52 | ✅ OK | Relationship linkage and related resources delivered; no coverage for 204 empty to-one responses or relationship-level meta. |
| Relationship mutation semantics (`POST`/`PATCH`/`DELETE`) | JSON:API §1.7 | `tests/Functional/Relationships/RelationshipWriteTest.php` lines 17-156 | ✅ OK | to-many add/remove/replace and to-one patch covered; missing concurrency/precondition scenarios and 202 asynchronous responses. |
| Atomic operations payload & results | JSON:API Atomic Operations §1.2-1.4 | `tests/Functional/Atomic/AtomicOperationsTest.php` lines 15-163 | ⚠️ Partially covered | Validates add/remove op scaffolding and errors; lacks transactionality, conditional ops, `atomic:results` error reporting, and side-effect coverage. |
| Profile hooks & controller integration | JSON:API Profiles §1.0 | *No functional coverage* | ❌ Gap | Need e2e tests ensuring negotiated profiles influence resource serialization, conflicts produce 406, and profile opt-outs respected. |
| Cache validators & preconditions (ETag, If-Match/If-None-Match, 304/412/428) | JSON:API §1.4; HTTP RFC 9110 | `tests/Unit/Http/Cache/ConditionalRequestEvaluatorTest.php` lines 18-116; `tests/Unit/Http/Cache/HeadersApplierTest.php` lines 18-30 | ⚠️ Partially covered | Evaluator logic tested; missing integration ensuring controllers emit validators per resource/include/fields combos and HEAD support. |
| Surrogate keys & invalidation | JSON:API Caching Recommendations | *No coverage* | ❌ Gap | Surrogate key publication/invalidation not exercised. |
| Related resource filtering/sorting/paging semantics | JSON:API §1.7 | `tests/Functional/Relationships/RelatedGetTest.php` lines 29-44 | ⚠️ Partially covered | Basic pagination on related; filtering/sorting/inclusion interplay untested. |
| Negation of unsupported media types/headers | JSON:API §1.2 | `tests/Functional/Errors/NegotiationErrorsTest.php` lines 17-58; `tests/Functional/ResourceWriteTest.php` lines 218-241 | ✅ OK | 406/415 errors emitted with proper headers. Need tests for 415 on relationships/atomic endpoints. |
